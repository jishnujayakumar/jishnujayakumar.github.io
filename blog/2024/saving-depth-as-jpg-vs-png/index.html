<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Save raw depth as JPEG or PNG? | Jishnu Jaykumar Padalunkal</title> <meta name="author" content="Jishnu Jaykumar Padalunkal"> <meta name="description" content="A case study of saving raw depth from fetch robot camera as JPEG and PNG"> <meta name="keywords" content="jishnu jaykumar padalunkal, phd student, utdallas, nvidia, iit-kgp, iisc, iiit vadodara"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="/blog/2024/saving-depth-as-jpg-vs-png/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Jishnu¬†</span>Jaykumar¬†Padalunkal</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/presentations">Presentations</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching">Teaching</a> </li> <li class="nav-item"> <a class="nav-link" href="https://drive.google.com/file/d/1VUsrI9BKeB4lmhxnfEi8CYO9jLzfR5vc" target="_blank">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Save raw depth as JPEG or PNG?</h1> <p class="post-meta">December 19, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a> ¬† ¬∑ ¬† <a href="/blog/tag/case-study"> <i class="fas fa-hashtag fa-sm"></i> case-study</a> ¬† <a href="/blog/tag/depth"> <i class="fas fa-hashtag fa-sm"></i> depth</a> ¬† ¬† ¬∑ ¬† <a href="/blog/category/research"> <i class="fas fa-tag fa-sm"></i> research</a> ¬† <a href="/blog/category/robotics"> <i class="fas fa-tag fa-sm"></i> robotics</a> ¬† <a href="/blog/category/phd-life"> <i class="fas fa-tag fa-sm"></i> phd-life</a> ¬† </p> </header> <article class="post-content"> <div id="markdown-content"> <p><img src="../../../assets/blog/jpg-vs-png/jpg-vs-png-depth-jumbotron.gif" alt="Docker for academic research" width="100%" height="auto"></p> <center>3D point cloud containing scenes created using <strong style="color:red">JPEG</strong> and <strong style="color:lightgreen">PNG</strong> Depth images.</center> <p><br></p> <hr> <h2 id="index">Index</h2> <ul> <li><a href="#index">Index</a></li> <li><a href="#the-spark-a-quest-for-compression">The Spark: A Quest for Compression</a></li> <li><a href="#the-twist-shaky-3d-scenes">The Twist: Shaky 3D Scenes</a></li> <li><a href="#rgb--jpeg-depth-scene-point-cloud">RGB + JPEG Depth Scene Point Cloud</a></li> <li><a href="#the-discovery-switching-to-png">The Discovery: Switching to PNG</a></li> <li><a href="#the-evidence-videos-and-point-clouds">The Evidence: Videos and Point Clouds</a></li> <li><a href="#lessons-learned-why-png-wins">Lessons Learned: Why PNG Wins</a></li> <li><a href="#closing-thoughts">Closing Thoughts</a></li> </ul> <hr> <h2 id="the-spark-a-quest-for-compression">The Spark: A Quest for Compression</h2> <p>In my recent robotics project, data collection was progressing at full steam. The challenge? Managing the ever-growing volume of RGB and depth images. üìà Compression seemed like the perfect solution. For RGB images, JPEG was a natural choice‚Äîefficient, widely used, and capable of reducing file sizes significantly. But then came the question: Could JPEG work for depth images too? üíæ</p> <p>Eager to streamline the process, I stored both RGB and depth images in JPEG format. It felt like a practical and straightforward decision at the time.</p> <hr> <h2 id="the-twist-shaky-3d-scenes">The Twist: Shaky 3D Scenes</h2> <p>Things took an unexpected turn when I moved to the next phase: generating 3D scene point clouds from the depth data. Point clouds are critical for extracting insights and performing spatial analysis. üß† Using my JPEG-based dataset, I plotted the point clouds‚Äîand that‚Äôs when the problems began. The 3D scenes were noisy, unstable, and lacked the precision I needed. ‚ùå</p> <p>Digging deeper, I realized that JPEG‚Äôs 8-bit storage capacity was the issue. Depth data, which demands high precision, was being constrained by the format‚Äôs limitations. Crucial details were lost, resulting in inaccuracies in the visualized 3D scenes.</p> <p><img src="../../../assets/blog/jpg-vs-png/rgbd-jpeg-3d.gif" width="100%"></p> <center>RGB + JPEG Depth Scene Point Cloud</center> <hr> <h2 id="the-discovery-switching-to-png">The Discovery: Switching to PNG</h2> <p>To address the issue, I switched to storing depth images in PNG format. Unlike JPEG, PNG supports 16-bit storage, which offers a much higher range for representing depth values. With this new setup, I recollected data and generated fresh point clouds. üé®</p> <p>The results were striking. The PNG-based depth data produced clear, accurate, and stable 3D scenes. The increased bit depth preserved the subtle variations in depth values, enabling precise visualization and analysis. üåÑ</p> <p>What seemed like a minor choice of file format turned out to have a major impact on the quality and usability of the data.</p> <p><img src="../../../assets/blog/jpg-vs-png/rgbd-png-3d.gif" width="100%"></p> <center>RGB + PNG Depth Scene Point Cloud</center> <hr> <h2 id="the-evidence-videos-and-point-clouds">The Evidence: Videos and Point Clouds</h2> <p>To highlight the differences, I created visual comparisons:</p> <video class="demo-video" width="100%" height="auto" controls=""> <source src="../../../assets/blog/jpg-vs-png/output_jpg.mp4" type="video/mp4"></source> Your browser does not support the video tag. </video> <center>RGB + JPEG Depth</center> <p><br></p> <video class="demo-video" width="100%" height="auto" controls=""> <source src="../../../assets/blog/jpg-vs-png/output_png.mp4" type="video/mp4"></source> Your browser does not support the video tag. </video> <center>RGB + PNG Depth</center> <p><br></p> <video class="demo-video" width="100%" height="auto" controls=""> <source src="../../../assets/blog/jpg-vs-png/rgbd-jpg-png.mp4" type="video/mp4"></source> Your browser does not support the video tag. </video> <center>3D scene point clouds created using depth data from both JPEG and PNG are shown in a single 3D frame.</center> <p><br></p> <p>It is evident that JPEG depth loses some depth information, while PNG is better at capturing a wider range of depth values. These visualizations clearly demonstrate why PNG is the superior choice for depth data.</p> <hr> <h2 id="lessons-learned-why-png-wins">Lessons Learned: Why PNG Wins</h2> <p>The key factor is <strong>bit depth</strong>. JPEG‚Äôs 8-bit limitation truncates depth information, leading to significant data loss. PNG‚Äôs 16-bit capacity retains the full range of depth values, preserving the integrity of the data.</p> <p>While JPEG remains excellent for RGB images, the precision needs of depth data make PNG the better option. The slightly larger file size is a small trade-off for the significant gains in accuracy and reliability. üìÅ</p> <p>Here‚Äôs what I did to subscribe to depth data from the ROS topic on the Fetch robot.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">depth</span><span class="p">.</span><span class="n">encoding</span> <span class="o">==</span> <span class="sh">"</span><span class="s">32FC1</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Convert depth message to OpenCV format
</span>    <span class="n">depth_cv</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cv_bridge</span><span class="p">.</span><span class="nf">imgmsg_to_cv2</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>

    <span class="c1"># Replace NaN values with 0 and convert from meters to millimeters
</span>    <span class="n">depth_cv</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">depth_cv</span><span class="p">)</span>
    <span class="n">depth_cv</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">depth_cv</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">depth_cv</span> <span class="o">=</span> <span class="n">depth_cv</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="c1"># Convert to uint16 for consistency
</span>    <span class="n">depth_cv</span> <span class="o">=</span> <span class="n">depth_cv</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint16</span><span class="p">)</span>

    <span class="c1"># TODO: Save as png
</span></code></pre></div></div> <hr> <h2 id="closing-thoughts">Closing Thoughts</h2> <p>In robotics, even seemingly minor decisions‚Äîlike choosing a file format‚Äîcan have far-reaching implications.</p> <p>Next time you‚Äôre deciding between JPEG and PNG for depth images, remember: precision matters. Choose wisely to let your data shine‚Äîclearly and accurately. ‚úÖ</p> <p>If you‚Äôve worked with other formats for depth data, I‚Äôd love to hear your insights. ü§ù‚ú®</p> <hr> <p>Feel free to reach out in case you have a query. You are always welcome. You can find me on X at <a href="https://x.com/jis_padalunkal" target="_blank">@jis_padalunkal</a>.</p> <script>document.getElementByClass("demo-video").playbackRate=1.5;</script> </div> </article> </div> </div> <footer class="fixed-bottom"> <center> <div class="container mt-0"> ¬© Copyright 2025 Jishnu Jaykumar Padalunkal. Theme: <a href="https://github.com/alshedivat/al-folio" target="_blank">Al-Folio</a>. Last updated: September 17, 2025. </div> </center> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-GDXDM8QC54"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GDXDM8QC54");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>